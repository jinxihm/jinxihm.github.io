<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="my place">
<meta name="author" content="fangliang">
<title>无魂</title>

<link href="resources/bootstrap331dist/css/bootstrap.css" rel="stylesheet">
<link href="resources/font-awesome-420/css/font-awesome.min.css" rel="stylesheet">
<link href="resources/css/style.css" rel="stylesheet">

<script src="resources/jquery/jquery-1.11.1.min.js"></script>
<script src="resources/bootstrap331dist/js/bootstrap.min.js"></script>
<script src="resources/avos/av-mini.js"></script>
<script src="resources/js/script.js"></script>
<script>
	$(document).ready(function() {

		AV.initialize(appId, appKey);

		// 加载全部标签
		loadTag();

		// 加载前20篇文章
		queryPost(0, 20);

		$('#tagPanel').on({
			click : function() {
				loadPostOfTag($(this).text());
			}
		}, ".tag");

		$('#newPostPlaceholder').click(function() {
			$(this).css('display', 'none');
			$('#newPostBox').css('display', 'block').focus();
			$('#toolBar').css('display', 'block');
			$('#newPostItem').css('margin-bottom', '15px').removeClass('top-radius');
			$('#newPostItem').css('box-shadow', '1px 1px 40px rgba(0, 109, 109, 1)');
			$('.first-post').addClass('top-radius');
			$('#postList .post-item').css('opacity', '0.1');
		});

		$('#newPostBox').blur(function() {
			var text = $(this).text();
			var html = $(this).html();
			if (text.trim() === "" && html.indexOf('<img') < 0 && html.indexOf('<video') < 0) {
				$(this).css('display', 'none');
				$('#toolBar').css('display', 'none');
				$('#newPostPlaceholder').css('display', 'block');
				$('#newPostItem').css('margin-bottom', '0px').addClass('top-radius');
				$('#newPostItem').css('box-shadow', 'none');
				$('.first-post').css('border-top-left-radius', '0px').removeClass('top-radius');
				$('#postList .post-item').css('opacity', '1');
			}
		});

		$('#newPostBox').keyup(function(e) {
			if ($(this).text().trim() === "") {
				$('#createPostBtn').prop('disabled', true);
			} else {
				$('#createPostBtn').prop('disabled', false);
				if (e.ctrlKey && e.which == 13) {
					$('#createPostBtn').click();
				}
			}
		});

		$('#createPostBtn').click(function() {
			savePost($('#newPostBox').text(), $('#newPostBox').html());
		});
		
		
		$('#postList').on({click:function(){
			$(this).parent().find('.info').toggleClass('hide');
		}},'.box');
		
		$('#postList').on({click:function(){
			$(this).css('display','none').next().css('display', 'block').focus();
			$('.comment-tool-bar').css('display','block');
		}},'.new-comment-placeholder');
		
		$('#postList').on({blur:function(){
			var text = $(this).text();
			var html = $(this).html();
			if (text.trim() === "" && html.indexOf('<img') < 0 && html.indexOf('<video') < 0) {
				$(this).css('display','none').prev().css('display','block');
				
			}
		},keyup:function(e){
			var createCommentBtn = $(this).next().find('.create-comment-btn')
			if ($(this).text().trim() === "") {
				createCommentBtn.prop('disabled', true);
			} else {
				createCommentBtn.prop('disabled', false);
				if (e.ctrlKey && e.which == 13) {
					createCommentBtn.click();
				}
			}
		}},'.new-comment-box');
		
		$('#postList').on({click:function(){
			var newCommentBox = $(this).parent().prev();
			createComment(newCommentBox.text(), newCommentBox.html(), '2323232323');
		}},'.create-comment-btn');

		

	});
</script>
</head>

<body>
  <div class="wrapper">
    <div class="dashboard-left">

      <div class="face-img">
        <img src="resources/img/t1.jpg">
      </div>

      <div class="face-text">
        <span>发现美</span>
        <span>·</span>
        <span>表达美</span>
      </div>

      <div id="tagPanel"></div>
      <!-- 模板 -->
      <span id="tagTempl" class="tag"></span>

    </div>
    <div class="content-main">
      <div id="newPostItem" class="post-item top-radius">
        <div id="newPostPlaceholder" class="box">有什么想法？</div>
        <div id="newPostBox" class="box" contentEditable=true spellcheck="false"></div>
        <div id="toolBar">
          <button id="createPostBtn" disabled type="button" class="btn btn-success">&nbsp;保&nbsp;存&nbsp;</button>
        </div>
      </div>

      <div id="postList"></div>
      <!-- 模板 -->
      <div class="post-item" id="postItemTempl">
        <div class="box"></div>
        <div class="info hide">
          <div class="opt">          
            <span>删除</span><span>2014-12-07</span><!-- <span><i class="fa fa-trash-o "></i></span>    -->  
          </div>
          <div class="comment-list">
            <span class="sort-asc"><i class="fa fa-sort-asc comment-arrow"></i></span>
            <div id="newCommentItem">
              <div class="comment-box new-comment-placeholder"><i class="fa fa-comment-o "></i>...</div>
              <div class="comment-box new-comment-box" contentEditable=true spellcheck="false"></div>
              <div class="comment-tool-bar">
                <button class="create-comment-btn btn btn-success"  disabled type="button" >&nbsp;保&nbsp;存&nbsp;</button>
              </div>
            </div>     
          </div>
        </div> 
      </div>
    </div>
  <div class="dashboard-right"></div>
  </div> 
  
  <div id="templates">
  
  
  
  
  
  </div><!-- end templates -->
  
  
</body>
</html>